<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../transforms/pp2html.xsl"?>

<!--
<?xml-model href="CCProtectionProfile.rng" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>    
-->

<!-- 
-->  


<Package name="Authentication Protocols"
  xmlns="https://niap-ccevs.org/cc/v1"
  xmlns:sec="https://niap-ccevs.org/cc/v1/section"
  xmlns:h="http://www.w3.org/1999/xhtml">

  <project-notes>
	This is the initial draft of a functional package for Authentication Protocols.
 </project-notes>

  <PPReference>
   <ReferenceTable>
      <PPTitle>Functional Package for Authentication Protocols</PPTitle>
      <PPVersion>1.0</PPVersion>
      <PPAuthor>National Information Assurance Partnership</PPAuthor>
      <PPPubDate>2022-01-20</PPPubDate>
      <Keywords>Authentication; X.509; EAP; Pre-shared Keys</Keywords>
    </ReferenceTable>
  </PPReference>
  
  <RevisionHistory>
    <entry>
      <version>1.0</version>
      <date>2022-01-20</date>
      <subject>Start of first draft.</subject>
    </entry>
  </RevisionHistory>
	
<!-- PP-style preferences   -->
  <pp-preferences>
<!--        <pp-pref name="display-audit-with-sfrs">0</pp-pref> -->
    <audit-events-in-sfrs/>
  </pp-preferences>

	
<!-- 			-->
<!-- 1.0 Introduction   -->
<!-- 			-->
<sec:Introduction>
	
<!-- 			-->
<!-- 1.1 Overview	-->
<!--			-->
  <sec:Overview>
	This Functional Package for Authentication Protocols gathers requirements for several 
	protocols and standards that are commonly used in NIAP Protection Profiles for authentication
	in network communications. It includes requirements for the Extensible Authentication Protocol (EAP), 
	requirements for the composition and exchange of pre-shared keys (PSK), and requirements for X.509 
	certificates. These protocols and standards are often used in setting up trusted channels,
	but may also be used for other purposes, such as authenticating wireless communications.<h:p/>
	More specialized protocols, such as 802.1X, RADIUS, Enrollment over Secure Transoort (EST), and 
	Certificate Management over CMS (CMC) are not currently included. <h:p/>
	This Functional Package is organized as a collection of requirements so that a Security Target can
	claim one or more "base requirements." Additional SFRs must be claimed based on dependencies in the 
	intially claimed SFRs.  
   </sec:Overview>

<!-- 			-->
<!-- 1.2 Terms		-->
<!-- 1.2.1 Common Criteria Terms -->
<!-- 1.2.2 Technology Terms -->
<!--			-->
	<tech-terms>
		<term abbr="CA" full="Certificate Authority">
			An entity that issues digital certificates.
		</term>
		<term abbr="CSR" full="Certificate Signing Request">
			A message sent from an applicant to a registration authority of the public key infrastructure 
			in order to apply for a digital identity certificate.
		</term>
		<term abbr="DN" full="Distinguished Name">
			A field in an X.509 certificate that uniquely identifies a person, organization, or business.
		</term>
		<term abbr="EAP" full="Extensible Authentication Protocol">
			A framework for adding arbitrary authentication methods in a standardized way to any
			protocol. The most common EAP method used with IKEv2 is EAP-TLS.
		</term>
		<term abbr="ECP" full="Eliptic Curve group modulo a Prime">
			Eliptic Curve Group Modulo a Prime.
		</term>
		<term abbr="ESN" full="Extended Sequence Number">
			An extension to the standard that allows IPsec to use 64-bit sequence numbers.
		</term>
		<term abbr="ESP" full="Encapsulating Security Payload">
			The protocol used by IPsec to transport encrypted and integrity-protected 
			communications across the network.
		</term>
		<term abbr="FQDN" full="Fully Qualified Domain Name">
			A domain name that specifies its exact location in the hierarchy of the Domain Name System (DNS).
		</term>
		<term abbr="ICMP" full="Internet Control Message Protocol">
			A supporting protocol in the Internet Protocol suite. It is used by network devices 
			to send error messages and operational information indicating success or failure when 
			communicating with another IP address. 
		</term>
		<term abbr="IKE" full="Internet Key Exchange">
			The protocol used by IPsec to set up and manage IPsec connections. This includes negotiating
			IPsec connection settings, authenticating endpoints to each other, defining 
			the security parameters of IPsec-protected connections, and negotiating session keys.  
			IKEv2 is the current version.
		</term>
		<term abbr="IPsec" full="Internet Protocol Security">
			A suite of open standards for ensuring private communications over public networks.
		</term>
		<term abbr="ISAKMP" full="Internet Security Association and Key Management Protocol">
			A protocol defined by RFC 2408 for establishing Security association (SA) and cryptographic keys in an
			Internet environment.	  
		</term>
		<term abbr="OCSP" full="Online Certificate Status Protocol">
			An Internet protocol used for obtaining the revocation status of an X.509 digital certificate.
		</term>
		<term abbr="PSK" full="Pre-Shared Key">
			A secret that was previously shared between two parties before it needs to be used.
		</term>
		<term abbr="SA" full="Security Association">
			The establishment of shared security attributes between two network entities to support secure 
			communication.
		</term>
		<term abbr="SPD" full="Security Policy Database">
			A set of rules that determines whether a packet is subject to IPsec processing.  
			Each entry in the SPD represents a policy that defines how the set of traffic covered under
			the policy will be processed.
		</term>
		<term abbr="UDP" full="User Datagram Protocol">
			A communications protocol that is primarily used to establish low-latency and loss-tolerating
			connections between applications on the internet. 
		</term>
		<term abbr="VPN" full="Virtual Private Network">
			An extension of a private network across a public or shared network that allows users to 
			exchange data as though they were connected directly to the private network.
		</term>
		<term abbr="XAUTH" full="Extended Authentication">
			An authentication scheme that supports an additional level of authentication by allowing the IPSec 
			gateway to request extended authentication from remote users.
		</term>
   </tech-terms>
     
<!-- 			-->
<!-- 1.3 Compliant Targets of Evaluation	-->
<!--			-->
    <sec:toes title="Compliant Targets of Evaluation">
		The Target of Evaluation (TOE) in this Functional Package (FP) is an IT product that 
		uses pre-shared keys, X.509 certificates, or the Extensible Authentication Protocol (EAP).
		Typically these protocols would be used in products that implement trusted channels or VPNs for 
		communications with other IT entities, or implement wireless security protocols. This FP describes 
		the security functionality of these protocols and standards in terms of <xref g="CC"/>. 
		<h:p/>
		The contents of this FP must be appropriately incorporated into a PP, cPP, or PP-Module. When this Package 
		is so incorporated, the ST must include selection-based requirements in accordance with the selections or 
		assignments indicated in the incorporating document.
		<h:p/>
		The PP, cPP, or PP-Module that instantiates this Package must typically include the below components in order
		to satisfy dependencies of this Package. It is the responsibility of the PP, cPP, or PP-Module author who 
		incorporates this FP to ensure that dependence on these components is satisfied, either by the TOE or by 
		assumptions about its Operational Environment.
		<h:p>An ST must identify the applicable version of the PP, cPP, or PP-Module and this
		Functional Package in its conformance claims.</h:p>
		
		<componentsneeded>
			<componentneeded>
				<componentid>FCS_CKM.1</componentid>
				<notes>To support key generation for IPsec, the incorporating document must
					include FCS_CKM.1 and specify the corresponding algorithms. </notes>
			</componentneeded>
			<componentneeded>
				<componentid>FCS_CKM.2</componentid>
					<notes>To support key establishment for IPsec, the incorporating document must
						include FCS_CKM.2 and specify the corresponding algorithms.</notes>
			</componentneeded>
			<componentneeded>
				<componentid>FCS_CKM_EXT.5</componentid>
					<notes>To support key derivation for IPsec, the incorporating document may need to include
						FCS_CKM_EXT.5 and specify the corresponding key derivation algorithms.</notes>
			</componentneeded>
			<componentneeded>
				<componentid>FCS_COP.1</componentid>
				<notes>
					To support the cryptography needed for IPsec communications, the incorporating document must include 
					FCS_COP.1 (iterating as needed) to specify AES with corresponding key sizes and modes, digital
					signature generation and verification function (at least one of RSA or ECDSA), a cryptographic hash
					function, and a keyed-hash message authentication function. In particular, this Package requires that the
					TOE support AES-GCM-128 and AES-GCM-256 for ESP, and AES-CBC-128 and AES-CBC-256 for IKE.					
				</notes>
			</componentneeded>
			<componentneeded>
				<componentid>FCS_RBG_EXT.1</componentid>
				<notes>To support random bit generation needed for IPsec key generation, the incorporating document must
					include a requirement that specifies the TOE's ability to invoke or provide 
					random bit generation services, commonly identified as FCS_RBG_EXT.1.</notes>
			</componentneeded>
			<componentneeded>
			<componentid>FIA_X509_EXT.2</componentid>
				<notes>To support establishment of IPsec communications using a public key algorithm that includes X.509, 
					the incorporating document must include FIA_X509_EXT.2 to specify the reasons for using X.509 certificates. 
					But is this really a dependency for this package? I don't think so.</notes>
			</componentneeded>
			<componentneeded>
			<componentid>FPT_STM.1</componentid>
				<notes>To support establishment of IPSec communications using a public key algorithm that includes X.509, 
					the incorporating document must include FPT_STM.1 or some other requirement that ensures reliable system time.  
					Note however that support for time-based rekey thresholds is selectable and not mandatory.</notes>
			</componentneeded>
		</componentsneeded>
	</sec:toes>
	
	<!--   1.4 Use Cases  -->
    <section title="Use Cases" id="s-usecases">
	    Although focused on IPsec, this Package contains requirements for several authentication protocols used by
		IPsec IKE protocols. If the TOE does not implement IPsec, but
	    it does implement one of the other protocols, then this Package can be used to integrate requirements for the other protocols
	    into the ST.
		<usecases> 
			<usecase title="EAP" id="uc-EAP">
				<description>
					This use case adds physical protections to the base requirements for server-class hardware.
					Additional physical protections are required because the platform us assumed to be minimally 
					protected by the by the operational environment. This use case can also be invoked for servers in 
					data centers where there are enhanced security requirements.<h:p/>
					This use case adds requirements for audit, physical protections, and Administrator 
					authentication to the base mandatory SFRs. 
					It removes the assumption that the TOE is physically protected by the OE.
				</description>
				<config>
					<ref-id>sfr-fia-eap-ext-1</ref-id>
				</config>
			</usecase>
			<usecase title="Pre-Shared Keys" id="uc-pre-shared-keys">
				<description>
					This use case defines the base requirements for portable clients. <h:p/>
					This use case adds no requirements to the base mandatory SFRs.
				</description>
				<config>
					<ref-id>sfr-fia-psk-ext-1</ref-id>
				</config>
			</usecase>
			<usecase title="X.509 Certificates" id="uc-x509">
				<description>
					This use case defines the base requirements for portable clients. <h:p/>
					This use case adds no requirements to the base mandatory SFRs.
				</description>
				<config>
					<ref-id>sfr-fia-psk-ext-1</ref-id>
				</config>
			</usecase>
		</usecases>

    </section>
	
	
	
</sec:Introduction>
  
<!-- 			-->
<!-- 2.0 Conformance Claims	-->
<!--			-->
<sec:Conformance_Claims>
      <!-- SME: the TLS package also uses the cclaim id="Conformance Statement" but in that 
	package, the actual text "Conformance Statement" doesn't get displayed, which is what
      	we would expect should be happening here as well (it shows up right underneath the 
	"Conformance Claimes" section header so it is redundant to display both the title and the
 	almost-identical subtitle -->
<!--
      <cclaim id="Conformance Statement">
        <description>This Package serves to provide Protection Profiles with additional 
          SFRs and associated Evaluation Activities specific to SSH clients and servers.  
          </h:p><h:p>
          This Package conforms to Common Criteria
          <cite linkend="bibCC" /> for Information Technology Security Evaluation, Version 3.1,
          Revision 5. It is CC Part 2 extended conformant.
          </h:p><h:p>
          In accordance with CC Part 1, dependencies are not included when they are addressed
          by other SFRs. The evaluation activities provide adequate proof that any dependencies are
          also satisfied.</description>
      </cclaim>
-->
	  <!--    <cclaims>
    
    </cclaims> -->
</sec:Conformance_Claims>

<!-- 				-->
<!-- 3.0 Security Requirements 	-->
<!--				-->
	
<!-- 			-->
<!-- 3.1 Security Functional Requirements 	-->
<!--			-->
<sec:Security_Functional_Requirements>

	<!-- Audit table for mandatory requirements  -->
	<sec:ss-audit-table title="Auditable Events for Mandatory SFRs">
		<h:p>
			The auditable events specified in this Package are included in a Security Target 
			if the incorporating PP, cPP, or PP-Module supports audit event reporting through FAU_GEN.1
			and all other criteria in the incorporating document are met.
		</h:p>
		<audit-table table="mandatory">
			<h:div class="table-caption"><ctr ctr-type="Table" id="atref-mandatory">: Auditable Events for Mandatory SFRs</ctr></h:div>
		</audit-table>
	</sec:ss-audit-table>
	  
	<!-- 			-->
	<!-- 3.1.1 FCS: Cryptgraphic Support	-->
	<!--			-->
	<sec:cryptsup title="Cryptographic Support (FCS)">
	
	    <!-- FCS_EAP_EXT.1 EAP-TLS -->
        <f-component cc-id="fcs_eap_ext.1" id="sfr-fcs-eap-ext-1" name="EAP-TLS">
<!--			<depends on-sel="sel-ipsec-psk-eap-tls"/>
			<depends on-sel="sel-ipsec-psk-eap-ttls"/>  -->
			<f-element id="fcs-eap-ext-1e1">
				<title>The TSF shall implement
					<selectables>
						<selectable>EAP-TLS protocol as specified in <xref to="bibRFC5216"/></selectable>
						<selectable>EAP-TTLS as specified in <xref to="bibRFC5281"/></selectable>
					</selectables>
					as updated by <xref to="bibRFC8996"/> with TLS implemented using mutual authentication in accordance
					with the <xref to="bibNIAPFPTLS"/>.
				</title>
			</f-element>
			<f-element id="fcs-eap-ext-1e2">
				<title>The TSF shall generate random values used in the
					<selectables>
						<selectable>EAP-TLS</selectable>
						<selectable>EAP-TTLS</selectable>
					</selectables>
					exchange using the RBG specified in FCS_RBG_EXT.1.
				</title>
			</f-element>
			<f-element id="fcs-eap-ext-1e3">
				<title>The TSF shall support peer authentication using certificates and
					<selectables>
						<selectable>PSK</selectable>
						<selectable id="sel-eap-auth-hotp">HOTP</selectable>
						<selectable id="sel-eap-auth-totp">TOTP</selectable>
						<selectable><assignable>other Authentication-verification protocols</assignable></selectable>
						<selectable exclusive="yes">no other authentication</selectable>
					</selectables>
					as updated by <xref to="bibRFC8996"/> with TLS implemented using mutual authentication in
					accordance with the <xref to="bibNIAPFPTLS"/>.
				</title>    
			</f-element>
			<f-element id="fcs-eap-ext-1e4">
				<title>
					The TSF shall not forward a EAP-success response if the client certificate is not valid according 
					to FIA_X509_EXT.1.
				</title>
			</f-element>

			<!-- This element does not belong here. It is an IKE requirement, and so it should
				be in the IPsec package. -->
			<f-element id="fcs-eap-ext-1e5">
				<title>The TSF shall use the MSK from the 
					<selectables>
						<selectable>EAP-TLS</selectable>
						<selectable>EAP-TTLS</selectable>
					</selectables> response as the IKEv2 shared secret in the authentication payload.
					<!-- Why is IKEv2 mentioned here? Do ther protocols besides IPsec use IKE? -->
				</title>
				<aactivity>
					<TSS>
						The evaluator shall verify that the TSS describes the use of EAP options for each of the 
						selected peer authentication mechanisms, that TLS with mutual authentication is used, that the
						random values are from an appropriate source, and that the EAP MSK is derived from the TLS
						master key and is used as the IKEv2 shared key.
					</TSS>
					<Guidance>
						The evaluator shall verify that the guidance documents describe any configurable features of 
						the EAP or TLS functionality, including instructions for configuration of the authenticators
						and registration processes for clients.
					</Guidance>
					<Tests>
						Testing for TLS functionality is in accordance with the TLS package.<h:p/>
						For each supported EAP method claimed in FCS_EAP_EXT.1.1 and for each authentication method 
						claimed in FCS_EAP_EXT.1.3, the evaluator shall perform the following tests:
						<testlist>
							<test>The evaluator shall follow AGD guidance to configure the TSF to use the EAP method
								claimed. The evaluator shall follow AGD guidance to configure the TSF to use the 
								authentication method claimed and, for EAP-TTLS, register an endpoint with appropriate
								key material required for the authentication method. The evaluator shall establish an 
								IPsec connection using a test endpoint with a valid certificate and, for EAP-TTLS, 
								configured to provide a correct value for the configured authenticator. The evaluator
								shall observe that the IPsec connection is successful.</test>
							<test>[conditional] If EAP-TTLS is supported, the evaluator shall cause the test endpoint with a
								valid certificate to send an invalid authenticator for the claimed authentication method:<h:ul>
								<h:li>For HOTP, replay the HOTP value sent previously.</h:li>
								<h:li>For TOTP or PSK, modify a byte of the properly constructed value,and observe that
									the TSF aborts the connection.</h:li></h:ul>
							</test>
							<test>The evaluator shall establish a new, valid certificate for a test endpoint using an 
								identifier not corresponding to a registered user. For EAP-TTLS, the evaluator shall cause
								the test endpoint using this certificate to send a correct authenticator value for the
								registered user. The evaluator shall initiate an IPsec connection from the test endpoint
								to the TSF and observe that the TSF aborts the connection.</test>
							<test>The evaluator shall follow AGD guidance to configure the TSF to use a supported EAP method
								and register the user with key material for required for a supported authentication method.
								The evaluator shall configure a test endpoint to respond to an IKEv2 exchange with 
								EAP-request, providing valid phase 1 handshake and valid TLS handshake, but computing 
								the phase 2 shared key using standard (non-EAP) methods. The evaluator shall initiate 
								an IPsec connection between the test endpoint and the TSF, and observe that the TSF aborts
								the connection.
							</test>
						</testlist>
					</Tests>
				</aactivity>
			</f-element>    
			<audit-event/>
        </f-component>	
		
    </sec:cryptsup>  <!-- FCS -->

	<!-- B.2 Identification and Authentication (FIA) -->
    <section title="Identification and Authentication (FIA)" id="s-fia">
        The TOE may support pre-shared keys for use in establishing an IPsec connection. PSK in the context of this document refer
		to generated values, memorized values subject to conditioning, one time passwords, and combinations of the
		above as described in FIA_PSK_EXT.1.2.  

        
		<!-- FIA_HOTP_EXT.1 -->
        <f-component cc-id="fia_hotp_ext.1" id="sfr-fia-hotp-ext-1" 
			name="HMAC-Based One-Time Password Pre-Shared Keys" status="sel-based">
			<depends on-sel="sel-psk-hotp"/>
			<depends on-sel="sel-psk-genhotp"/>
			<depends on-sel="sel-psk-pwhotp"/>
			<depends on-sel="sel-eap-auth-hotp"/>
			<f-element id="fia-hotp-ext-1e1">
				<title>
					The TSF shall support HMAC-Based One-Time Password authentication (HOTP) in accordance with
					<xref to="bibRFC4226"/> to authenticate the user before establishing an IPsec connection. 
				</title>
			</f-element>
			<f-element id="fia-hotp-ext-1e2">
				<title>
					The TSF shall generate a HOTP seed of 
					<selectables>
						<selectable>128</selectable>
						<selectable>256</selectable>
					</selectables> bits in accordance with FCS_RBG_EXT.1.
				</title>
			</f-element>
			<f-element id="fia-hotp-ext-1e3">
				<title>The TSF shall generate a new HOTP seed value for each IPsec connection.</title>
			</f-element>
			<f-element id="fia-hotp-ext-1e4">
				<title>
					The TSF shall utilize 
					<selectables>
						<selectable>HMAC-SHA-1</selectable>
						<selectable>HMAC-SHA-256</selectable>
						<selectable>HMAC-SHA-384</selectable>
						<selectable>HMAC-SHA-512</selectable>
					</selectables> 
					with key sizes <assignable>key size (in bits) used in HMAC</assignable> 
					to derive a HOTP hash from the HOTP seed and counter.
				</title>
				<note role="application">
					The assignment must be consistent with the key sizes supported by the relevant iteration of FCS_COP.1.
				</note>
			</f-element>
			<f-element id="fia-hotp-ext-1e5">
				<title>
					The TSF shall truncate the HOTP hash per FIA_HOTP_EXT.1.4 to create a HOTP of  
					<selectables onlyone="yes">
						<selectable>administrator configurable character length of at least 6</selectable>
						<selectable>preset character length of
							<selectables onlyone="yes">
								<selectable>6</selectable>
								<selectable>7</selectable>
								<selectable>8</selectable>
								<selectable>9</selectable>
								<selectable>10</selectable>
							</selectables>
						</selectable>
					</selectables>.
				</title>
				<note role="application">
					The ST author may either provide a configurable character length of at
					least 6 or a preset size between 6 and 10.
				</note>
			</f-element>
			<f-element id="fia-hotp-ext-1e6">
				<title>
					The TSF shall 
					<selectables>
						<selectable>throttle invalid requests to 
							<selectables>
								<selectable>administrator configurable value</selectable>
								<selectable><assignable>value less than 10</assignable></selectable>
							</selectables> per minute
						</selectable>
						<selectable>lock the associated account after 
							<selectables>
								<selectable>administrator configurable value</selectable>
								<selectable><assignable>value less than 10</assignable></selectable>
							</selectables> failed attempts until 
							<selectables>
								<selectable>an administrator unlocks the account</selectable>
								<selectable>a configurable time period</selectable>
							</selectables>
						</selectable>
					</selectables>.
				</title>
				<note role="application">
					The ST author may select throttle requests, account lockout, or both.
				</note>
			</f-element>
			<f-element id="fia-hotp-ext-1e7">
				<title>
					The TSF shall not verify HOTP attempts outside of the counter look ahead window of 
					<selectables>
						<selectable>a configurable value</selectable>
						<selectable><assignable>a value less than or equal to 3</assignable></selectable>
					</selectables> for resynchronization.
				</title>
			</f-element>
			<f-element id="fia-hotp-ext-1e8">
				<title>The TSF shall increment the counter after each successful authentication.</title>
				<note role="application">
					The HOTP seed and all derived values are considered secret keys for purposes of protection.<h:p/>
					This requirement must be claimed if "<h:i>verify the HOTP</h:i>" is selected in FIA_PSK_EXT.4.2.
				</note>
				<aactivity>
					<TSS>
						The evaluator shall confirm the TSS describes how the TOE complies with <xref to="bibRFC4226"/>.<h:p/>
						The evaluator shall confirm the TSS describes how the HOTP seed is generated and ensure it 
							aligns with FCS_RBG_EXT.1.<h:p/>
						The evaluator shall confirm the TSS describes how the HOTP seed is protected and ensure it
							aligns with the storage requirements of the base PP.<h:p/>
						The evaluator shall confirm the TSS describes how a new HOTP seed is assigned for each client
							and how each client is uniquely identified.<h:p/>
						The evaluator shall confirm the TSS describes how the HOTP seed is conditioned into a HOTP hash
							and verify it matches the selection in FIA_HOTP_EXT.1.4.<h:p/>
						The evaluator shall confirm the TSS describes how the HOTP hash is truncated and verify it
							matches the selection in FIA_HOTP_EXT.1.5.<h:p/>
						The evaluator shall confirm the TSS describes how the TOE handles multiple incoming invalid 
							requests and verify it provides anti-hammer mechanism that match the selections 
							FIA_HOTP_EXT.1.6.<h:p/>
						The evaluator shall confirm the TSS describes how the TOE handles resynchronization and how it
							rejects attempts outside of the look-ahead window selected in FIA_TOTP_EXT.1.7.<h:p/>
						The evaluator shall confirm the TSS describes how the TOE how the counter is incremented after 
							each successful authentication.<h:p/>
					</TSS>
					<Guidance>
						The evaluator shall verify the operational guidance contains all configuration guidance for
						setting any administrative value that is configurable in the FIA_HOTP_EXT.1 requirements.
					</Guidance>
					<Tests>
						The evaluator shall configure the TOE to use a supported HOTP factor then:
						<testlist>
							<test>Attempt to establish a connection using a factor from a different client, the test 
								passes if the client fails to connect.</test>
							<test>Attempt multiple connections outside the boundary set in FIA_HOTP_EXT.1.6 and verify 
								the remediation is triggered.  The test passes if remediation is triggered as defined 
								in the selections and assignments.</test>
							<test>Attempt to use a HOTP that is outside of the value allowed with for resynchronization.
								The test passes if the client fails to connect.</test>
							<test>Attempt to connect with a valid HOTP, disconnect and attempt to authenticate again
								with the same HOTP value.  The test passes if the client connects the first time and 
								fails to connect the second time. If the HOTP generated is duplicated the test may be
								repeated.</test>
						</testlist>
					</Tests>
				</aactivity>
			</f-element>
			<audit-event/>
        </f-component>

	  
		<!-- FIA_PSK_EXT.1 Pre-Shared Key Composition -->
        <f-component cc-id="fia_psk_ext.1" id="sfr-fia-psk-ext-1" name="Pre-Shared Key Composition">
<!--			<depends on-sel="sel-ipsec-psk"/> 
			<depends on-sel="sel-psk-eap-tls"/>
			<depends on-sel="sel-psk-eap-ttls"/>		-->
			<f-element id="fia-psk-ext-1e1">
				<title>
					The TSF shall be capable of using pre-shared keys for establishing IPsec connections. 
				</title>
			</f-element>
			<f-element id="fia-psk-ext-1e2">
				<title>
					The TSF shall be able to accept the following as pre-shared keys: 
					<selectables>
						<selectable id="sel-psk-gen">Generated bit-based</selectable>
						<selectable id="sel-psk-pw">Password-based</selectable>
						<selectable id="sel-psk-hotp">HMAC based one time password</selectable>
						<selectable id="sel-psk-totp">Time based one time password</selectable>
						<selectable id="sel-psk-genhotp">Combination of a generated bit-based and HMAC-based one-time password</selectable>
						<selectable id="sel-psk-gentotp">Combination of a generated bit-based and time-based one-time password</selectable>
						<selectable id="sel-psk-pwhotp">Combination of a password-based and HMAC-based one-time password</selectable>
						<selectable id="sel=psk-pwtotp">Combination of a password-based and time-based one-time password</selectable>
					</selectables> keys.
				</title>
				<note role="application">
					If any selection including "<h:i>generated bit-based</h:i>" keys is selected, then FIA_PSK_EXT.2 must be claimed.<h:p/>
					If any selection including "<h:i>password-based</h:i>" keys is selected then FIA_PSK_EXT.3 must be claimed. <h:p/>
					If any selection including "<h:i>HMAC-based one-time password</h:i>" keys is selected then FIA_PSK_EXT.4 must be claimed.<h:p/> 
					If any selection including "<h:i>time-based one-time password</h:i>" is selected then FIA_PSK_EXT.5 must be claimed.<h:p/> 
					This requirement must be claimed if "<h:i>Pre-shared keys</h:i>" is selected in FCS_IPSEC_EXT.1.11.
				</note>
				<aactivity>
					<TSS>
						The evaluator shall examine the TSS to ensure that it identifies that IPsec connections may use
						pre-shared keys.  The evaluator shall confirm that the TSS states which pre-shared key selections 
						are supported. 
					</TSS>    
					<Guidance>
						The evaluator shall examine the operational guidance to determine that it provides guidance to 
						administrators on how to configure all selected pre-shared key options if any configuration is 
						required.
					</Guidance>         
					<Tests>
						The evaluator shall also perform the following tests for each protocol (or instantiation of a 
						protocol, if performed by a different implementation on the TOE). 
						<testlist>
							<test>
								For each mechanism selected in FIA_PSK_EXT.1.2 the evaluator shall attempt to establish a 
								connection and confirm that the connection requires the selected factors in the PSK to 
								establish the connection. 
							</test>
						</testlist>
					</Tests>
				</aactivity>
			</f-element>
			<audit-event/>
        </f-component>

		
		<!-- FIA_PSK_EXT.2 Generated Pre-Shared Keys -->		
        <f-component cc-id="fia_psk_ext.2" id="sfr-fia-psk-ext-2" name="Generated Pre-Shared Keys" status="sel-based">
			<depends on-sel="sel-psk-gen"/>
			<depends on-sel="sel-psk-genhotp"/>
			<depends on-sel="sel-psk-gentotp"/>
			<f-element id="fia-psk-ext-2e1">
				<title>
					The TSF shall be able to 
					<selectables>
						<selectable>accept externally generated</selectable>
						<selectable>generate 
							<selectables>
								<selectable>128</selectable>
								<selectable>256</selectable>
							</selectables> bit-based pre-shared keys via FCS_RBG_EXT.1. 
						</selectable>
					</selectables>
				</title>
				<note role="application">
					Generated PSKs are expected to be shared between components via an out of band mechanism. <h:p/>            
					This requirement must be claimed if any selection in FIA_PSK_EXT.1.2 includes "<h:i>generated bit-based</h:i>" keys.
				</note>
				<aactivity>
					<TSS>
						If "<h:i>generate</h:i>" is selected the evaluator shall confirm that this process uses the RBG specified
						in FCS_RBG_EXT.1 and the output matches the size selected in FIA_PSK_EXT.2.1. <h:p/>
					</TSS>
					<Guidance>
						The evaluator shall confirm the operational guidance contains instructions for entering 
						generated pre-shared keys. 
					</Guidance>
					<Tests>
						<testlist>
							<test>[conditional] If "<h:i>generate</h:i>" was selected the evaluator shall generate a
								pre-shared key and confirm the output matches the size selected in FIA_PSK_EXT.2.1.
							</test>
						</testlist>
					</Tests>
				</aactivity>
			</f-element>
			<audit-event/>
        </f-component>

        
		<!-- FIA_PSK_EXT.3 Password-based Pre-Shared Keys -->
        <f-component cc-id="fia_psk_ext.3" id="sfr-fia-psk-ext-3" name="Password-Based Pre-Shared Keys" status="sel-based">
			<depends on-sel="sel-pskpw"/>
			<depends on-sel="sel-psk-pwhotp"/>
			<depends on-sel="sel-psk-pwtotp"/>
			<f-element id="fia-psk-ext-3e1">
				<title>
					The TSF shall support a PSK of up to <assignable>positive integer of 64 or more</assignable> 
					characters. 
				</title>
				<note role="application">
					The ST author assigns the maximum size of the PSK it supports; it must support at least 
					64 characters or a length defined by the platform. 
				</note>
			</f-element>
			<f-element id="fia-psk-ext-3e2">
				<title>The TSF shall allow PSKs to be composed of any combination of upper case characters, 
					lower case characters, numbers, and the following special characters: 
					"!", "@", "#", "$", "%", "^", "&amp;", "*", "(", and ")", and 
					<selectables>
						<selectable><assignable>other supported special characters</assignable></selectable>
						<selectable exclusive="yes">no other characters</selectable>
					</selectables>
				</title>
				<note role="application">
					The ST author assigns any other supported characters; if there are no other supported characters, 
					then "<h:i>no other characters</h:i>" should be selected. 
				</note>
			</f-element>
			<f-element id="fia-psk-ext-3e3">
				<title>
					The TSF shall perform Password-based Key Derivation Functions in accordance with a specified 
					cryptographic algorithm 
					<selectables>
						<selectable>HMAC-SHA-256</selectable>
						<selectable>HMAC-SHA-384</selectable>
						<selectable>HMAC-SHA-512</selectable>
					</selectables>, with 
					<assignable>positive integer of 4096 or more</assignable> iterations], and
					output cryptographic key sizes 
					<selectables>
						<selectable>128</selectable>
						<selectable>256</selectable>
					</selectables> that meet the following: <xref to="bibNIST800132"/>.
				</title>
				<note role="application">
					The ST author selects the parameters based on the PBKDF used by the TSF. 
				</note>
			</f-element>
			<f-element id="fia-psk-ext-3e4">
				<title>The TSF shall not accept PSKs less than 
					<selectables>
						<selectable>a value settable by the administrator</selectable>
						<selectable><assignable>minimum PSK length accepted by the TOE, must be >= 6</assignable></selectable>
					</selectables> and greater than the maximum PSK length defined in FIA_PSK_EXT.3.1.
				</title>
				<note role="application">
					If the minimum length is settable, then ST author chooses "<h:i>a value settable by the administrator</h:i>".
					If the minimum length is not settable, the ST author fills in the assignment with the minimum 
					length the PSK must be. This requirement is to ensure bounds work properly.
				</note>
			</f-element>
			<f-element id="fia-psk-ext-3e5">
				<title>
					The TSF shall generate all salts using an RBG that meets FCS_RBG_EXT.1 and with entropy corresponding 
					to the key size selected for PBKDF in FIA_PSK_EXT.3.3.
				</title>
			</f-element>
			<f-element id="fia-psk-ext-3e6">
				<title>
					The TSF shall require the PSK to be entered before every initiated connection.
				</title>
			</f-element>   
            <f-element id="fia-psk-ext-3e7">
				<title>
					The TSF shall 
					<selectables>
						<selectable>provide a password strength meter</selectable>
						<selectable>check the password against a blacklist</selectable>
						<selectable exclusive="yes">perform no action to assist the user in choosing a strong password</selectable>
					</selectables>. 
				</title>
				<note role="application">
                    For FIA_PSK_EXT.3.7, the ST author may select one, both, or neither of the functions in alignment
					with <xref to="bibNIST80063b"/>.<h:p/>
					This requirement is selection dependent on FIA_PSK_EXT.1. 
				</note>
				<aactivity>
					<TSS>
						The evaluator shall examine the TSS to ensure it describes the process by which the bit-based
						pre-shared keys used. If generated is selected the evaluator shall confirm that this process
						uses the RBG specified in FCS_RBG_EXT.1. <h:p/>
						Support for length: The evaluators shall check to ensure that the TSS describes the allowable 
						ranges for PSK lengths, and that at least 64 characters or a length defined by the platform may
						be specified by the user.<h:p/>
						Support for character set: The evaluator shall check to ensure that the TSS describes the
						allowable character set and that it contains the characters listed in the SFR.<h:p/>
						Support for PBKDF: The evaluator shall examine the TSS to ensure that the use of PBKDF2 is 
						described and that the key sizes match that described by the ST author.<h:p/>
						The evaluator shall check that the TSS describes the method by which the PSK is first encoded
						and then fed to the hash algorithm. The settings for the algorithm (padding, blocking, etc.)
						shall be described, and the evaluator shall verify that these are supported by the selections 
						in this component as well as the selections concerning the hash function itself. <h:p/>
						For the NIST SP 800-132-based conditioning of the PSK, the required evaluation activities will 
						be performed when doing the evaluation activities for the appropriate requirements
						(e.g., FCS_COP.1/KeyedHash). <h:p/>
						The evaluator shall confirm that the minimum length is described.<h:p/>
						The ST author shall provide a description in the TSS regarding the salt generation. The
						evaluator shall confirm that the salt is generated using an RBG described in FCS_RBG_EXT.1.<h:p/>
						[conditional] If "<h:i>password strength meter</h:i>" or "<h:i>password blacklist</h:i>" is
						selected, the evaluator shall examine the TSS to ensure any password checking functionality
						provided by the TSF is described and contains details on how the function operates.<h:p/>
					</TSS>
					<Guidance>
						The evaluator shall confirm the operational guidance contains instructions for entering 
						bit-based pre-shared keys for each protocol identified in the requirement, or generating a 
						bit-based pre-shared key (or both). The evaluator shall confirm that any configuration
						management functions related to pre-shared keys that are performed by the TOE are specified 
						in the operational guidance.  <h:p/>
						The guidance must specify the allowable characters for pre-shared keys, and that list must
						include, at minimum, the same items contained in FIA_PSK_EXT.3.2. <h:p/>
						The evaluator shall confirm the operational guidance contains any necessary instructions for 
						enabling and configurating password checking functionality. <h:p/>
					</Guidance>
					<Tests>
						Support for Password/Passphrase characteristics: In addition to the analysis above, the 
						evaluator shall also perform the following tests on a TOE configured according to the
						Operational Guidance:
						<testlist>
							<test>The evaluator shall compose a pre-shared key of at least 64 characters that contains
								a combination of the allowed characters in accordance with the FIA_PSK_EXT.1.3 and
								verify that a successful protocol negotiation can be performed with the key. </test>
							<test>[conditional] If the TOE supports pre-shared keys of multiple lengths, the evaluator
								shall repeat Test 1 using the minimum length and invalid lengths that are below the 
								minimum length, above the maximum length, null length, empty length, or zero length. 
								The minimum test should be successful, and the invalid lengths must be rejected by the
								TOE. </test>
							<test>[conditional] If the TOE initiates connections, initiate and establish a remote
								connection, disconnect from the connection, verify that the PSK is required when 
								initiating the connection a second time.</test>
							<test>[conditional] If the TOE supports a password meter, the evaluator shall enter a
								password and verify the password checker responds per the description in the TSS.</test>
							<test>[conditional] If the TOE supports a password blacklist, the evaluator shall enter
								a blacklisted password and verify that the password is rejected or flagged as such.</test>
						</testlist>
					</Tests>
				</aactivity>
			</f-element>
			<audit-event/>
        </f-component>

        
		<!-- FIA_PSK_EXT.4 HMAC-based One-Time Password Pre-Shared Keys Support -->
        <f-component cc-id="fia_psk_ext.4" id="sfr-fia-psk-ext-4" 
			name="HMAC-Based One-Time Password Pre-shared Keys Support" status="sel-based">
			<depends on-sel="sel-psk-hotp"/>
			<depends on-sel="sel-psk-genhotp"/>
			<depends on-sel="sel-psk-pwhotp"/>
			<f-element id="fia-psk-ext-4e1">
				<title>
					The TSF shall accept and send a HOTP while initiating an IPsec connection.
				</title>
			</f-element>
			<f-element id="fia-psk-ext-4e2">
				<title> The TSF shall 
					<selectables onlyone="yes">
						<selectable>verify the HOTP</selectable>
						<selectable>verify the HOTP via an external authentication server</selectable>
					</selectables> before establishing an incoming connection.
				</title>
				<note role="application">
					This requirement must be claimed if "<h:i>HMAC-based one-time password</h:i>" is included in a selection
					in FIA_PSK_EXT.1.2.
				</note>
				<aactivity>
					<TSS>
						The evaluator shall verify the TSS describes how the HOTP is input into the client and how that
						value is sent to the server.<h:p/>
						The evaluator shall verify the TSS describes how the HOTP is accepted from an incoming 
						connection and how that value is verified, either by the TOE or by an external authentication 
						server.<h:p/>
					</TSS>
					<Guidance>
						The evaluator shall verify the operational guidance contains any configuration necessary to
						enable HOTP.<h:p/>
					</Guidance>
					<Tests>
						<testlist>
							<test>The evaluator shall configure the TOE to use a supported HOTP factor, then attempt to
								establish a connection using that factor.</test>
							<test>The evaluator shall verify the client prompts the user for the HOTP before initiating
								the connection.  </test>
							<test>The evaluator shall verify the server validates the HOTP or receives confirmation 
								from an authentication server before establishing the channel.</test>
						</testlist>
					</Tests>
				</aactivity>
			</f-element>
			<audit-event/>
        </f-component>
		
		<!-- FIA_PSK_EXT.5 Time-Based One-Time Password Pre-shared Keys Support -->
        <f-component cc-id="fia_psk_ext.5" id="sfr-fia-psk-ext-5" 
			name="Time Based One Time Password Pre-shared Keys Support" status="sel-based">
			<depends on-sel="sel-psk-totp"/>
			<depends on-sel="sel-psk-gentotp"/>
			<depends on-sel="sel-psk-pwtotp"/>
			<f-element id="fia-psk-ext-5e1">
				<title>The TSF shall accept and send a TOTP while initiating an IPsec connection.</title>
			</f-element>
			<f-element id="fia-psk-ext-5e2">
				<title>The TSF shall 
					<selectables onlyone="yes">
						<selectable id="sel-psk5-ext-e2-verify">verify the TOTP</selectable>
						<selectable>verify the TOTP via an external authentication server</selectable>
					</selectables> before establishing an incoming connection.
				</title>
				<note role="application">
					If "<h:i>verify the TOTP</h:i>" is selected then FIA_TOTP_EXT.1 must be claimed.<h:p/>
					This requirement must be claimed if "<h:i>Time-based one-time password</h:i>" is included in a selection
					in FIA_PSK_EXT.1.2.
				</note>
				<aactivity>
					<TSS>
						The evaluator shall verify the TSS describes how the TOTP is input into the client and how that
						value is sent to the server.<h:p/>
						The evaluator shall verify the TSS describes how the TOTP is accepted from an incoming
						connection and how that value is verified, either by the TOE or by an external authentication
						server.<h:p/>
					</TSS>
					<Guidance>
						The evaluator shall verify the operational guidance contains any configuration necessary to
						enable TOTP.
					</Guidance>
					<Tests>
						<testlist>
							<test>The evaluator shall configure the TOE to use a supported TOTP factor, then attempt
								to establish a connection using that factor.  </test>
							<test>The evaluator shall verify the client prompts the user for the TOTP before initiating
								the connection.  </test>
							<test>The evaluator shall verify the server validates the TOTP or receives confirmation 
								from an authentication server before establishing the channel.</test>
						</testlist>
					</Tests>
				</aactivity>
			</f-element>
			<audit-event/>
        </f-component>
     
        <!-- FIA_TOTP_EXT Time-Based One-Time Password Pre-Shared Keys -->
        <f-component cc-id="fia_totp_ext.1" id="sfr-fia-totp-ext-1" 
			name="Time-Based One-Time Password Pre-Shared Keys" status="sel-based">
			<depends on-sel="sel-eap-auth-totp"/>
			<depends on-sel="sel-psk-totp"/>
			<depends on-sel="sel-psk-pwtotp"/>
			<depends on-sel="sel-psk-gentotp"/>
			<f-element id="fia-totp-ext-1e1">
				<title>
					The TSF shall support Time-Based One-Time Password (TOTP) authentication in accordance 
					with <xref to="bibRFC6238"/> to authenticate the user before establishing an IPsec connection. 
				</title>
			</f-element>
			<f-element id="fia-totp-ext-1e2">
				<title>
					The TSF shall generate a TOTP seed according to FCS_RBG_EXT.1 of 
					<selectables>
						<selectable>128</selectable>
						<selectable>256</selectable>
					</selectables> bits.
				</title>
			</f-element>
			<f-element id="fia-totp-ext-1e3">
				<title>The TSF shall generate a new TOTP seed for each IPsec connection.</title>
			</f-element>
			<f-element id="fia-totp-ext-1e4">
				<title>
					The TSF shall utilize 
					<selectables>
						<selectable>HMAC-SHA-1</selectable>
						<selectable>HMAC-SHA-256</selectable>
						<selectable>HMAC-SHA-384</selectable>
						<selectable>HMAC-SHA-512</selectable>
					</selectables> with key sizes 
					<assignable>key size (in bits) used in HMAC</assignable> 
					to derive a TOTP hash from the TOTP seed and current time provided by NTP.
				</title>
				<note role="application">
					The selection must be consistent with the key sizes permitted by the relevant iteraton of FCS_COP.1.
				</note>
			</f-element>
			<f-element id="fia-totp-ext-1e5">
				<title>
					The TSF shall truncate the TOTP hash per FIA_TOTP_EXT.1.4 to create a TOTP of  
					<selectables>
						<selectable>administrator configurable character length of at least 6</selectable>
						<selectable>preset character length of
							<selectables onlyone="yes"> 
								<selectable>6</selectable>
								<selectable>7</selectable>
								<selectable>8</selectable>
								<selectable>9</selectable>
								<selectable>10</selectable>
							</selectables>
						</selectable>
					</selectables>.
				</title>
				<note role="application">
				    The ST author may either provide a configurable character length of at least 6 or a preset 
					size between 6 and 10.
				</note>
			</f-element>
			<f-element id="fia-totp-ext-1e6">
				<title>The TSF shall
					<selectables>
						<selectable>throttle invalid requests to 
							<selectables>
								<selectable>administrator configurable value</selectable>
								<selectable><assignable>value less than 10</assignable></selectable>
							</selectables> per minute</selectable>
						<selectable>lock the associated account after 
							<selectables>
								<selectable>administrator configurable value</selectable>
								<selectable><assignable>value less than 10</assignable></selectable>
							</selectables> failed attempts until 
							<selectables>
								<selectable>an administrator unlocks the account</selectable>
								<selectable>a configurable time period</selectable>
							</selectables>
						</selectable>
					</selectables>.
				</title>
				<note role="application">
				    The ST may select throttle requests, account lockout, or both.
				</note>
			</f-element>
			<f-element id="fia-totp-ext-1e7">
				<title>The TSF shall set a time-step size of 
					<selectables>
						<selectable>a configurable value</selectable>
						<selectable><assignable>a value less than or equal to 30</assignable></selectable>
					</selectables> seconds.
				</title>
			</f-element>
			<f-element id="fia-totp-ext-1e8">
				<title>The TSF shall not validate a drift of more than 
					<selectables>
						<selectable>a configurable value</selectable>
						<selectable><assignable>a value less than or equal to 3</assignable></selectable>
					</selectables> time-steps.            
				</title>
			</f-element>
			<f-element id="fia-totp-ext-1e9">
				<title>The TSF shall 
					<selectables onlyone="yes">
						<selectable>allow resynchronization by recording time drift within the limit of FIA_TOTP_EXT.2.8</selectable>
						<selectable>not permit resynchronization</selectable>
					</selectables>.           
				</title>          
				<note role="application">
					The TOTP seed and all derived values are considered secret keys for purposes of protection.<h:p/>
					This requirement must be claimed if "verify the TOTP" is selected in FCS_PSK_EXT.5.2.
				</note>
				<aactivity>
					<TSS>
						The evaluator shall confirm the TSS describes how the TOE complies with <xref to="bibRFC6238"/><h:p/>.
						The evaluator shall confirm the TSS describes how the TOTP seed is generated and ensure it
							aligns with FCS_RBG_EXT.1.<h:p/>
						The evaluator shall confirm the TSS describes how the TOTP seed is protected and ensure it
							aligns with the storage requirements of the base PP. <h:p/>
						The evaluator shall confirm the TSS describes how a new TOTP seed is assigned for each client
							and how each client is uniquely identified.<h:p/>
						The evaluator shall confirm the TSS describes how the TOTP seed is conditioned into a TOTP
							hash and verify it matches the selection in FIA_TOTP_EXT.1.4.<h:p/>
						The evaluator shall confirm the TSS describes how the TOTP hash is truncated and verify it
							matches the selection in FIA_TOTP_EXT.1.5.<h:p/>
						The evaluator shall confirm the TSS describes how the TOE handles multiple incoming requests
							and verify it provides anti-hammer mechanism that matches the selections FIA_TOTP_EXT.2.6.<h:p/>
						The evaluator shall confirm the TSS describes how the TOE sets a time-step value and verify it
							matches the selections in the ST.<h:p/>
						The evaluator shall confirm the TSS describes how the TOE handles drift and resynchronization
							and verify it matches the selections.  The evaluator shall ensure the TSS describes how 
							time is kept and drift is calculated.  If drift is recorded the evaluator shall ensure the 
							TSS how this is done.<h:p/>
					</TSS>
					<Guidance>
						The evaluator shall verify the operational guidance contains all configuration guidance for
						setting any administrative value that is configurable in the FIA_TOTP_EXT.1 requirements.
					</Guidance>
					<Tests>
						The evaluator shall configure the TOE to use a supported TOTP factor then:
						<testlist>
							<test>Attempt to establish a connection using a factor from a different client, the test
								passes if the client fails to connect.</test>
							<test>Attempt multiple connections outside the boundary set in FIA_TOTP_EXT.1.6 and verify
								the remediation is triggered.  The test passes if remediation is triggered as defined in
								the selections and assignments.</test>
							<test>Attempt to use a TOTP that is outside of the value allowed with for resynchronization.
								The test passes if the client fails to connect.</test>
							<test>Attempt to connect with a valid TOTP, disconnect and attempt to authenticate again 
								with the same TOTP.  The test passes if the client connects the first time and fails to
								connect the second time. If the TOTP generated is duplicated the test may be repeated.</test>
						</testlist>
					</Tests>
				</aactivity>
			</f-element>
			<audit-event/>
        </f-component>
        
		<!-- FIA_X509_EXT.1 -->
        <f-component id="sfr-fia-x509-ext-1" cc-id="fia_x509_ext.1" name="X.509 Certificate Validation">
<!--			<f-element id="fel-certauth-how"> -->
				<title>
					The application shall 
					<selectables onlyone="yes">
						<selectable>invoke platform-provided functionality</selectable>
						<selectable>implement functionality</selectable>
					</selectables>
					to validate certificates in accordance with the following rules:<h:ul>
						<h:li>RFC 5280 certificate validation and certificate path validation.</h:li>
						<h:li>The certificate path must terminate with a trusted CA certificate.</h:li>
						<h:li>The application shall validate a certificate path by ensuring the presence of the 
							basicConstraints extension and that the CA flag is set to TRUE for all CA 
							certificates, and that any path constraints are met.
						</h:li>
						<h:li>The application shall validate that any CA certificate includes caSigning purpose in the key
							usage field</h:li>
						<h:li>The application shall validate the revocation status of the certificate using 
							<selectables>
								<selectable>OCSP as specified in RFC 6960</selectable>
								<selectable>CRL as specified in RFC 5280 Section 6.3</selectable>
								<selectable>CRL as specified in RFC 8603</selectable>
								<selectable>an OCSP TLS Status Request Extension (OCSP stapling) as specified in RFC 6066</selectable>
								<selectable>OCSP TLS Multi-Certificate Status Request Extension (i.e., OCSP Multi-Stapling) as specified in RFC 6961</selectable>
							</selectables>.
						</h:li>
						<h:li>The application shall validate the extendedKeyUsage (EKU) field according to the 
							following rules:<h:ul>
							<h:li>Certificates used for trusted updates and executable code integrity verification 
								shall have the Code Signing Purpose (id-kp 3 with OID 1.3.6.1.5.5.7.3.3) in the 
								extendedKeyUsage field.
							</h:li>
							<h:li>Server certificates presented for TLS shall have the Server Authentication
								purpose (id-kp 1 with OID 1.3.6.1.5.5.7.3.1) in the EKU field.
							</h:li>
							<h:li>
								Client certificates presented for TLS shall have the Client Authentication purpose 
								(id-kp 2 with OID 1.3.6.1.5.5.7.3.2) in the EKU field.
							</h:li>
							<h:li>
								S/MIME certificates presented for email encryption and signature shall have the 
								Email Protection purpose (id-kp 4 with OID 1.3.6.1.5.5.7.3.4) in the EKU field.
							</h:li>
							<h:li>
								OCSP certificates presented for OCSP responses shall have the OCSP Signing purpose 
								(id-kp 9 with OID 1.3.6.1.5.5.7.3.9) in the EKU field.
							</h:li>
							<h:li>
								Server certificates presented for EST shall have the CMC Registration Authority 
								(RA) purpose (id-kp-cmcRA with OID 1.3.6.1.5.5.7.3.28) in the EKU field.
							</h:li></h:ul>
						</h:li>
					</h:ul>
				</title>
				<note role="application">
					FIA_X509_EXT.1.1 lists the rules for validating certificates. The ST author shall select whether
					revocation status is verified using OCSP or CRLs. FIA_X509_EXT.2 requires that certificates are
					used for HTTPS, TLS, and DTLS; this use requires that the extendedKeyUsage rules are verified.
					If OCSP is not supported the EKU provision for checking the OCSP Signing purpose is met by 
					default.<h:p/>
					This requirement is included if the protocol(s) selected in FTP_DIT_EXT.1.1 require the use of
					certificates. If the TOE implements TLS as a HTTPS/TLS server with no mutual authentication,
					this requirement is not applicable.<h:p/>
					OCSP stapling and OCSP multi-stapling only support TLS server certificate validation. If other 
					certificate types are validated, either OCSP or CRL should be claimed.<h:p/>
					Regardless of the selection of "<h:i>implement functionality or invoke platform-provided 
					functionality</h:i>," the validation is expected to end in a trusted root CA certificate in a root
					store managed by the platform.
				</note>
				<aactivity level="element">
					<TSS>
						The evaluator shall ensure the TSS describes where the check of validity of the certificates
						takes place. The evaluator ensures the TSS also provides a description of the certificate 
						path validation algorithm.<h:p/>
					</TSS>
					<Guidance>None.<h:p/></Guidance>
					<Tests>
						The tests described must be performed in conjunction with the other certificate services evaluation 
						activities, including the functions in FIA_X509_EXT.2.1. The tests for the extendedKeyUsage rules are 
						performed in conjunction with the uses that require those rules. If the application supports chains of
						length four or greater, the evaluator shall create a chain of at least four certificates: 
						the node certificate to be tested, two Intermediate CAs, and the self-signed Root CA. If 
						the application supports a maximum trust depth of two, then a chain with no Intermediate
						CA should instead be created.
						<testlist>
							<test>
								The evaluator shall demonstrate that validating a certificate without a valid certification path results in the function 
								failing, for each of the following reasons, in turn:<h:ul>
								<h:li>by establishing a certificate path in which one of the issuing certificates is not a CA certificate,</h:li>
								<h:li>by omitting the basicConstraints field in one of the issuing certificates,</h:li>
								<h:li>by setting the basicConstraints field in an issuing certificate to have CA=False,</h:li>
								<h:li>by omitting the CA signing bit of the key usage field in an issuing certificate, and</h:li>
								<h:li>by setting the path length field of a valid CA field to a value strictly less than the certificate path.</h:li>
								</h:ul>
								The evaluator shall then establish a valid certificate path consisting of valid CA certificates, and demonstrate that the 
								function succeeds. The evaluator shall then remove trust in one of the CA certificates, and show that the function fails.
							</test>
							<test>
								The evaluator shall demonstrate that validating an expired certificate results in the function failing.
							</test>
							<test>
								The evaluator shall test that the TOE can properly handle revoked certificates-conditional on whether
								CRL, OCSP, OCSP Stapling or OCSP Multi-stapling is selected; if multiple methods are selected, then
								the following tests shall be performed for each method:
								<h:ul>
								<h:li>The evaluator shall test revocation of the node certificate.</h:li>
								<h:li>The evaluator shall also test revocation of an intermediate CA certificate (i.e. the intermediate
									CA certificate should be revoked by the root CA), if intermediate CA certificates are supported.
									If OCSP stapling per RFC 6066 is the only supported revocation method, this test is omitted.</h:li>
								<h:li>The evaluator shall ensure that a valid certificate is used, and that the validation function 
									succeeds. The evaluator then attempts the test with a certificate that has been revoked (for each 
									method chosen in the selection) to ensure when the certificate is no longer valid that the 
									validation function fails.</h:li>
								</h:ul>
							</test>
							<test>
								If any OCSP option is selected, the evaluator shall configure the OCSP server or use a
								man-in-the-middle tool to present a certificate that does not have the OCSP signing purpose and verify
								that validation of the OCSP response fails. If CRL is selected, the evaluator shall configure the CA 
								to sign a CRL with a certificate that does not have the cRLsign key usage bit set, and verify that
								validation of the CRL fails.
							</test>
							<test>
								The evaluator shall modify any byte in the first eight bytes of the certificate and demonstrate that 
								the certificate fails to validate. (The certificate will fail to parse correctly.)
							</test>
							<test>
								 The evaluator shall modify any byte in the last byte of the certificate and demonstrate that the 
								 certificate fails to validate. (The signature on the certificate will not validate.)
							</test>
							<test>
								The evaluator shall modify any byte in the public key of the certificate and demonstrate that the
								certificate fails to validate. (The signature on the certificate will not validate.)
							</test>
							<test>
								 (Conditional on support for EC certificates as indicated in FCS_COP.1/Sig). The evaluator shall establish a valid,
								 trusted certificate chain consisting of an EC leaf certificate, an EC Intermediate CA certificate not 
								 designated as a trust anchor, and an EC certificate designated as a trusted anchor, where the elliptic 
								 curve parameters are specified as a named curve. The evaluator shall confirm that the TOE validates 
								 the certificate chain.
							</test>
							<test>
								(Conditional on support for EC certificates as indicated in FCS_COP.1/Sig). The evaluator shall replace
								the intermediate certificate in the certificate chain for Test 9 with a modified certificate, where 
								the modified intermediate CA has a public key information field where the EC parameters uses an 
								explicit format version of the Elliptic Curve parameters in the public key information field of the
								intermediate CA certificate from Test 9, and the modified Intermediate CA certificate is signed by 
								the trusted EC root CA, but having no other changes. The evaluator shall confirm the TOE treats the
								certificate as invalid.
							</test>
						</testlist>
					</Tests>
				</aactivity>
			</f-element>
			<f-element id="fel-ca-who">
				<title>
					The application shall treat a certificate as a CA certificate only if the 
					basicConstraints extension is present and the CA flag is set to TRUE.
				</title>
				<note role="application">
					This requirement applies to certificates that are used and processed by the 
					TSF and restricts the certificates that may be added as trusted CA certificates.
				</note>
				<aactivity level="element">
					<TSS>None.<h:p/></TSS>
					<Guidance>None.<h:p/></Guidance>
					<Tests>
						The tests described must be performed in conjunction with the other certificate 
						services evaluation activities, including the functions in FIA_X509_EXT.2.1.
						If the application supports chains of length four or greater, 
						the evaluator shall create a chain of at least four certificates: the 
						node certificate to be tested, two Intermediate CAs, and the self-signed Root CA.
						If the application supports a maximum trust depth of two, then a chain with
						no Intermediate CA should instead be created.
						<testlist>
							<test>
								The evaluator shall ensure that the certificate of at least one of the CAs in the chain does not contain the 
								basicConstraints extension. The evaluator shall confirm that validation of the certificate path 
								fails (i) as part of the validation of the peer certificate belonging to this chain; and/or 
								(ii) when attempting to add the CA certificate without the basicConstraints extension to the TOE's trust store.
							</test>
							<test>
								The evaluator shall ensure that the certificate of at least one of the CAs in the chain has the CA flag in the 
								basicConstraints extension not set (or set to FALSE). The evaluator shall confirm that validation of the certificate 
								path fails (i) as part of the validation of the peer certificate belonging to this chain; and/or (ii) when attempting 
								to add the CA certificate with the CA flag not set (or set to FALSE) in the basicConstraints extension to the TOE's trust store.
							</test>
						</testlist>
					</Tests>
				</aactivity>
			</f-element>
        </f-component>	   
	    
    </section>  <!-- FIA -->
      

</sec:Security_Functional_Requirements>
  
<!--                    -->
<!-- Appendix A: Optional Requirements 	-->
<!--                    -->
	
<appendix id="appendix-optional-plus" title="Optional Requirements">  

    <!-- Contents of the appendix are totally generated by "optional-appendix-plus" xsl template. 
         Includes boilerplate, headers, audit table. So the below is not needed. But there is is. -->
    <!--    <audit-table table="optional">
	  Auditable events for Optional SFRs:<h:br/><h:br/>
	</audit-table>  -->
</appendix> 

<!--                    -->
<!-- Appendix B: Selection-based Requirements 	-->
<!--                    -->

    <appendix id="appendix-sel-based" title="Selection-Based Requirements"> 
       
    <!-- Contents of the appendix are totally generated by "optional-appendix" xsl template. 
         Includes boilerplate, headers, audit table. So the below is not needed. But there is is. -->
    <!--    <audit-table table="sel-based">
	  Auditable events for Selecton-based Requirements:	
	</audit-table>   -->
    </appendix> 
	
<!--                    -->
<!-- Appendix C: References 	-->
<!--                    -->
	
   <bibliography>	
		<entry id="bibNIAPFPTLS">
			<tag>Functional Package for TLS</tag>
			<description>
				<h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?id=439">
					Functional Package for Transport Layer Security (TLS)</h:a>
			</description>
		</entry>   
<!--		<entry id="bibNIST80057">
			<tag>NIST SP 800-57 Part 1 Rev. 5</tag>
			<description>
				<h:a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57pt1r5.pdf">
					Recommendation for Key Management: Part 1 - General</h:a>
			</description>
		</entry>   -->
		<entry id="bibNIST80063b">
			<tag>NIST SP 800-63B</tag>
			<description>
				<h:a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63b.pdf">
					Digital Identity Guidelines: Authentication and Lifecycle Management</h:a>
			</description>
		</entry>   
		<entry id="bibNIST800132">
			<tag>NIST SP 800-132 Part 1</tag>
			<description>
				<h:a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-132.pdf">
				Recommendation for Password-Based Key Derivation Part 1: Storage Applications</h:a>
			</description>
		</entry>   
		<entry id="bibRFC2407">
			<tag>RFC 2407</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc2407">The Internet IP Security Domain of Interpretation for ISAKMP</h:a>
			</description>
		</entry>   
<!--		<entry id="bibRFC2408">
			<tag>RFC 2408</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc2408">Internet Security Association and Key Management Protocol (ISAKMP)</h:a>
			</description>
		</entry>   -->
<!--		<entry id="bibRFC2409">
			<tag>RFC 2409</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc2409">The Internet Key Exchange (IKE)</h:a>
			</description>
		</entry>  --> 
<!--		<entry id="bibRFC3602">
			<tag>RFC 3602</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc3602">The AES-CBC Cipher Algorithm and Its Use with IPsec</h:a>
			</description>
		</entry>   -->
<!--		<entry id="bibRFC4106">
			<tag>RFC 4106</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc4106">The Use of Galois/Counter Mode (GCM)
					in IPsec Encapsulating Security Payload (ESP)</h:a>
			</description>
		</entry>   -->
<!--		<entry id="bibRFC4109">
			<tag>RFC 4109</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc4109">Algorithms for Internet Key Exchange version 1 (IKEv1)</h:a>
			</description>
		</entry>   -->
		<entry id="bibRFC4226">
			<tag>RFC 4226</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc4226">HOTP: An HMAC-Based One-Time Password Algorithm</h:a>
			</description>
		</entry>  		
<!--		<entry id="bibRFC4301">
			<tag>RFC 4301</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</h:a>
			</description>
		</entry>  --> 
<!--		<entry id="bibRFC4303">
			<tag>RFC 4303</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</h:a>
			</description>
		</entry>   -->
<!--		<entry id="bibRFC4304">
			<tag>RFC 4304</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc4304">Extended Sequence Number (ESN) Addendum to
					IPsec Domain of Interpretation (DOI) for Internet Security Association
					and Key Management Protocol (ISAKMP)</h:a>
			</description>
		</entry>   -->
<!--		<entry id="bibRFC4868">
			<tag>RFC 4868</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc4868">Using HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512 with IPsec</h:a>
			</description>
		</entry>   -->
<!--		<entry id="bibRFC4945">
			<tag>RFC 4945</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc4945">The Internet IP Security PKI Profile of IKEv1/ISAKMP, IKEv2, and PKIX</h:a>
			</description>
		</entry>   -->
		<entry id="bibRFC5216">
			<tag>RFC 5216</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc5216">The EAP-TLS Authentication Protocol</h:a>
			</description>
		</entry>   
		<entry id="bibRFC5281">
			<tag>RFC 5281</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc5281">Extensible Authentication Protocol Tunneled Transport
					Layer Security Authenticated Protocol Version 0 (EAP-TTLSv0)</h:a>
			</description>
		</entry>   
<!--		<entry id="bibRFC5282">
			<tag>RFC 5282</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc5282">Using Authenticated Encryption Algorithms with the 
					Encrypted Payload of the Internet Key Exchange version 2 (IKEv2) Protocol</h:a>
			</description>
		</entry>   -->
		<entry id="bibRFC6238">
			<tag>RFC 6238</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc6238">TOTP: Time-Based One-Time Password Algorithm</h:a>
			</description>
		</entry>   
<!--		<entry id="bibRFC6379">
			<tag>RFC 6379</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc6379">Suite B Cryptographic Suites for IPsec</h:a>
			</description>
		</entry>   -->
<!--		<entry id="bibRFC7296">
			<tag>RFC 7296</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc7296">Internet Key Exchange Protocol Version 2 (IKEv2)</h:a>
			</description>
		</entry>   -->
<!--		<entry id="bibRFC8247">
			<tag>RFC 8247</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc8247">Algorithm Implementation Requirements and Usage Guidance
					for the Internet Key Exchange Protocol Version 2 (IKEv2)</h:a>
			</description>
		</entry>   -->
<!--		<entry id="bibRFC8784">
			<tag>RFC 8784</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc8784">Mixing Preshared Keys in the Internet Key Exchange Protocol Version 2
					(IKEv2) for Post-quantum Security</h:a>
			</description>
		</entry>   -->
		<entry id="bibRFC8996">
			<tag>RFC 8996</tag>
			<description>
				<h:a href="https://tools.ietf.org/html/rfc8996">Deprecating TLS 1.0 and TLS 1.1</h:a>
			</description>
		</entry>   
    </bibliography>
</Package>
